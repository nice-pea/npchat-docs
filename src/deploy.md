### Доставка и развертование

Рабочая директория проекта `/opt/npchat`, доступ на запись есть только у пользователей группы `npchat`.

Параметра для запуска приложения распологаются в `/opt/npchat/.env.production`, читать может только группа.

Новые файлы в директории создаются с группой npchat, так как установлен [setgid](https://man.archlinux.org/man/setgid.2.ru).

В корне рабочей директории располагаются директории релизов, куда помещается код или бинарные файлы сборок (прим.: /opt/npchat/v0.0.1-alpha).

Приложение запускается внутри docker-контейнера с именем `npchat.api`, образ для запуска контейнера создается с версией, которая совпадает с названием директории.

Автоматизация развертования организована в 3 этапа:
1. Сначала, по средствам github actions или вручную, создается тэг с версией в репозитории.
2. Затем, вызывается action, который отправляет код тэга на сервер, в соответствующую директорию и собирает образ.
3. Затем, вызывается action, который запускает контейнер из образа, предварительно удалив существующий контейнер. В случае ошибки запуска нового контейнера, будет запущен старый контейнер из прошлой рабочей версии. Если прошлая версия не запустилась, будет оправлено emergency оповещение. 